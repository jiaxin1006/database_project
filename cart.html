<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³¼ç‰©è»Š</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #333;
            color: white;
        }

        .header-buttons button {
            background-color: #163c64;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            margin-left: 10px;
        }

        .header-buttons button:hover {
            background-color: #0018b3;
        }

        .cart-container {
            padding: 20px;
        }

        .customer-group {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: white;
        }

        .customer-info {
            display: flex;
            align-items: center;
            font-weight: bold;
            /* è¨­ç‚ºç²—é«” */
            margin-bottom: 10px;
        }

        .customer-info h3,
        .customer-info p {
            margin-right: 20px;
            /* æ§åˆ¶é …ç›®ä¹‹é–“çš„è·é›¢ */
        }

        .payment-checkbox {
            margin-left: 10px;
        }


        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }

        .product-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            margin-right: 20px;
        }

        .product-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .edit-quantity {
            width: 60px;
            margin-left: 10px;
        }

        .delete-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
        }

        .delete-button:hover {
            background-color: #c82333;
        }

        .checkout-button {
            width: 100%;
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 4px;
        }

        .hidden {
            display: none;
        }

        .paid {
            background-color: rgba(128, 128, 128, 0.5);
            /* é€æ˜ç°è‰² */
        }

        .paid-text {
            color: green;
            font-weight: bold;
        }

        .payment-checkbox {
            margin-left: 10px;
            cursor: pointer;
        }
    </style>
    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let isEditMode = false; // åˆå§‹éç·¨è¼¯æ¨¡å¼

        // åˆ‡æ›ç·¨è¼¯æ¨¡å¼
        function toggleEditMode() {
            isEditMode = !isEditMode;
            loadCart(); // é‡æ–°æ¸²æŸ“è³¼ç‰©è»Šå…§å®¹
            const editButton = document.getElementById('editButton');
            editButton.innerText = isEditMode ? 'å®Œæˆ' : 'ç·¨è¼¯';
        }

        // ç”¨æ–¼è™•ç†ä»˜æ¬¾ç‹€æ…‹è®Šæ›´
        function togglePaidStatus(customerName) {
            const customerGroup = document.getElementById(`customer-group-${customerName}`);
            const checkbox = document.getElementById(`checkbox-${customerName}`);

            if (checkbox.checked) {
                customerGroup.classList.add('paid');
                const paidText = document.createElement('span');
                paidText.classList.add('paid-text');
                paidText.innerText = 'å·²ä»˜æ¬¾';
                customerGroup.appendChild(paidText);
            } else {
                customerGroup.classList.remove('paid');
                const paidText = customerGroup.querySelector('.paid-text');
                if (paidText) paidText.remove();
            }
        }

        function loadCart() {
            const cartContainer = document.getElementById('cart-container');
            cartContainer.innerHTML = ""; // æ¸…ç©ºå…§å®¹

            if (cart.length === 0) {
                cartContainer.innerHTML = "<p>æ‚¨çš„è³¼ç‰©è»Šæ˜¯ç©ºçš„ã€‚</p>";
                return;
            }

            const customerGroups = {};

            // å°‡å•†å“æŒ‰è³¼è²·äººåˆ†çµ„
            cart.forEach(item => {
                if (!customerGroups[item.name]) {
                    customerGroups[item.name] = [];
                }
                customerGroups[item.name].push(item);
            });
            for (const customerName in customerGroups) {
                const items = customerGroups[customerName];
                let totalQuantity = 0;
                let totalPrice = 0;

                // è¨ˆç®—ç¸½æ•¸é‡å’Œç¸½åƒ¹æ ¼
                items.forEach(item => {
                    totalQuantity += item.quantity;
                    totalPrice += item.price * item.quantity;
                });

                let groupHTML = `
            <div class="customer-group" id="customer-group-${customerName}">
                <div class="customer-info">
                    <h3 style="font-weight: bold;">è³¼è²·äºº: ${customerName}</h3>
                    <p style="font-weight: bold; margin-right: 20px;">ç¸½åƒ¹æ ¼: $${totalPrice.toFixed(2)}</p>
                    <input type="checkbox" id="checkbox-${customerName}" class="payment-checkbox" onclick="togglePaidStatus('${customerName}')">
                </div>
            <div class="product-list">
        `;

                // æ¸²æŸ“æ¯å€‹å•†å“
                items.forEach((item, index) => {
                    groupHTML += `
                <div class="product-item">
                    <img src="${item.image}" alt="${item.productName}">
                    <div class="product-info">
                        <span>å•†å“: ${item.productName}</span>
                        <span>
                            æ•¸é‡: 
                            ${isEditMode ? `<input type="number" class="edit-quantity" value="${item.quantity}" min="1" onchange="editQuantity('${customerName}', ${index}, this.value)">` : item.quantity}
                        </span>
                        <span>åƒ¹æ ¼: $${item.price} x ${item.quantity} = $${(item.price * item.quantity).toFixed(2)}</span>
                    </div>
                    ${isEditMode ? `<button class="delete-button" onclick="deleteItem('${customerName}', ${index})">åˆªé™¤</button>` : ''}
                </div>
            `;
                });


                groupHTML += `</div></div>`;
                cartContainer.innerHTML += groupHTML;
            }
        }

        function editQuantity(customerName, index, newQuantity) {
            if (newQuantity < 1) {
                alert("æ•¸é‡ä¸èƒ½å°æ–¼ 1");
                return;
            }
            const customerItems = cart.filter(item => item.name === customerName);
            customerItems[index].quantity = parseInt(newQuantity);
            saveCart();
            loadCart();
        }

        function deleteItem(customerName, index) {
            if (confirm("ç¢ºå®šè¦åˆªé™¤æ­¤å•†å“å—ï¼Ÿ")) {
                let customerItems = cart.filter(item => item.name === customerName);
                cart = cart.filter(item => item.name !== customerName); // ç§»é™¤è©²è³¼è²·äººçš„æ‰€æœ‰å•†å“
                customerItems.splice(index, 1); // åˆªé™¤å–®å€‹å•†å“
                cart = cart.concat(customerItems); // åŠ å›å‰©é¤˜çš„å•†å“
                saveCart();
                loadCart();
            }
        }

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        window.onload = loadCart;
    </script>
</head>

<body>
    <header>
        <h1>è³¼ç‰©è»Š</h1>
        <div class="header-buttons">
            <button onclick="window.location.href = 'index.html';">ğŸ›’ è¿”å›å•†åº—</button>
            <button id="editButton" onclick="toggleEditMode()">ç·¨è¼¯</button>
        </div>
    </header>

    <div class="cart-container" id="cart-container">
        <!-- è³¼ç‰©è»Šå…§å®¹å°‡é€é JS å‹•æ…‹åŠ è¼‰ -->
    </div>

</body>

</html>